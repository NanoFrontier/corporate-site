class u{container;currentPage;totalPages;pdfDoc;touchStartX;constructor(t){this.container=t,this.currentPage=1,this.totalPages=0,this.pdfDoc=null,this.touchStartX=null,this.init()}async init(){typeof window.pdfjsLib>"u"&&await this.loadPDFJS(),this.bindEvents(),await this.loadPDF()}async loadPDFJS(){const t=["https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js","https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js","https://cdnjs.cloudflare.com/ajax/libs/pdfjs-dist/3.11.174/build/pdf.min.js"];for(let e=0;e<t.length;e++)try{console.log(`Trying CDN ${e+1}: ${t[e]}`),await this.loadScript(t[e]),console.log(`PDF.js loaded successfully from CDN ${e+1}`);const n=t[e].replace("pdf.min.js","pdf.worker.min.js");window.pdfjsLib.GlobalWorkerOptions.workerSrc=n,console.log("Worker configured:",n);return}catch(n){if(console.warn(`CDN ${e+1} failed:`,n),e===t.length-1)throw new Error("All CDNs failed")}}loadScript(t){return new Promise((e,n)=>{const i=document.createElement("script");i.src=t,i.onload=()=>{console.log(`Script loaded successfully: ${t}`),e()},i.onerror=r=>{console.error(`Script failed to load: ${t}`,r),n(new Error(`Failed to load: ${t}`))},document.head.appendChild(i)})}async loadPDF(){try{const t=await fetch("/pdfs/NanoFrontier_Business_Overview_Simple.pdf");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.arrayBuffer(),n=new Uint8Array(e),i=window.pdfjsLib.getDocument({data:n});this.pdfDoc=await i.promise,this.totalPages=this.pdfDoc.numPages,this.currentPage=1,this.renderPage(),this.updatePageInfo(),this.updateNavigation(),this.hideLoading()}catch(t){console.error("PDF読み込みエラー:",t),this.hideLoading()}}hideLoading(){const t=this.container.querySelector("#loading"),e=this.container.querySelector("#canvas-container");t&&t.classList.add("hidden"),e&&e.classList.remove("hidden")}renderPage(){if(!this.pdfDoc)return;const t=this.container.querySelector("#pdf-canvas");if(!t)return;const e=t.getContext("2d");e&&this.pdfDoc.getPage(this.currentPage).then(n=>{const i=n.getViewport({scale:1});t&&(t.width=i.width,t.height=i.height);const r=this.container.clientWidth-40,a=this.container.clientHeight-40,c=r/i.width,d=a/i.height,h=Math.min(c,d,1),o=n.getViewport({scale:h});t&&(t.width=o.width,t.height=o.height);const l={canvasContext:e,viewport:o};n.render(l),this.updatePageInfo(),this.updateProgress()})}updatePageInfo(){if(!this.pdfDoc)return;const t=this.container.querySelector("#current-page"),e=this.container.querySelector("#total-pages");t&&(t.textContent=this.currentPage.toString()),e&&(e.textContent=this.totalPages.toString())}updateNavigation(){const t=this.container.querySelector("#prev-page"),e=this.container.querySelector("#next-page");t&&(t.disabled=this.currentPage<=1),e&&(e.disabled=this.currentPage>=this.totalPages)}updateProgress(){if(!this.totalPages)return;const t=(this.currentPage-1)/(this.totalPages-1)*100,e=this.container.querySelector("#progress-bar");e&&(e.style.width=`${t}%`)}goToPage(t){!this.pdfDoc||t<1||t>this.pdfDoc.numPages||(this.currentPage=t,this.renderPage(),this.updateNavigation())}nextPage(){this.pdfDoc&&this.currentPage<this.pdfDoc.numPages&&this.goToPage(this.currentPage+1)}prevPage(){this.currentPage>1&&this.goToPage(this.currentPage-1)}bindEvents(){const t=this.container.querySelector("#prev-page"),e=this.container.querySelector("#next-page"),n=this.container.querySelector("#prev-zone"),i=this.container.querySelector("#next-zone");t?.addEventListener("click",()=>this.prevPage()),e?.addEventListener("click",()=>this.nextPage()),n?.addEventListener("click",()=>this.prevPage()),i?.addEventListener("click",()=>this.nextPage()),document.addEventListener("keydown",this.handleKeyDown);const r=this.container.querySelector("#pdf-canvas");r&&(r.addEventListener("touchstart",this.handleTouchStart),r.addEventListener("touchend",this.handleTouchEnd))}handleKeyDown=t=>{this.container.contains(document.activeElement)&&(t.key==="ArrowLeft"?this.prevPage():t.key==="ArrowRight"&&this.nextPage())};handleTouchStart=t=>{this.touchStartX=t.touches[0].clientX};handleTouchEnd=t=>{if(!this.touchStartX)return;const e=t.changedTouches[0].clientX,n=this.touchStartX-e;Math.abs(n)>50&&(n>0?this.nextPage():this.prevPage()),this.touchStartX=null};destroy(){document.removeEventListener("keydown",this.handleKeyDown);const t=this.container.querySelector("#pdf-canvas");t&&(t.removeEventListener("touchstart",this.handleTouchStart),t.removeEventListener("touchend",this.handleTouchEnd))}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".pdf-viewer").forEach(t=>{t instanceof HTMLElement&&new u(t)})});
